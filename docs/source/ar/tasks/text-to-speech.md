# ุชุญููู ุงููุต ุฅูู ููุงู

[[open-in-colab]]

ุชุญููู ุงููุต ุฅูู ููุงู (TTS) ูู ูููุฉ ุฅูุดุงุก ููุงู ุทุจูุนู ูู ูุต ููุชูุจุ ุญูุซ ูููู ุชูููุฏ ุงูููุงู ุจุนุฏุฉ ูุบุงุช ููุนุฏุฉ ูุชุญุฏุซูู. ููุงู ุงูุนุฏูุฏ ูู ููุงุฐุฌ ุชุญููู ุงููุต ุฅูู ููุงู ุงููุชุงุญุฉ ุญุงูููุง ูู ๐ค Transformersุ ูุซู [Bark](../model_doc/bark)ุ [MMS](../model_doc/mms)ุ [VITS](../model_doc/vits) ู [SpeechT5](../model_doc/speecht5).

ููููู ุจุณูููุฉ ุฅูุดุงุก ุตูุช ุจุงุณุชุฎุฏุงู ุฎุท ุฃูุงุจูุจ "text-to-audio" (ุฃู ุงูุงุณู ุงููุณุชุนุงุฑ ุงูุฎุงุต ุจู - "text-to-speech"). ูููู ูุจุนุถ ุงูููุงุฐุฌุ ูุซู Barkุ ุฃูุถูุง ุฃู ุชููู ูุดุฑูุทุฉ ูุชูููุฏ ุงุชุตุงูุงุช ุบูุฑ ููุธูุฉ ูุซู ุงูุถุญู ูุงูุชููุฏ ูุงูุจูุงุกุ ุฃู ุญุชู ุฅุถุงูุฉ ุงูููุณููู.
ูููุง ููู ูุซุงู ุนูู ููููุฉ ุงุณุชุฎุฏุงู ุฎุท ุฃูุงุจูุจ "text-to-speech" ูุน Bark:

```py
>>> from transformers import pipeline

>>> pipe = pipeline("text-to-speech", model="suno/bark-small")
>>> text = "[clears throat] This is a test ... and I just took a long pause."
>>> output = pipe(text)
```

ูููุง ููู ููุชุทู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุชู ููููู ุงุณุชุฎุฏุงููุง ููุงุณุชูุงุน ุฅูู ุงูุตูุช ุงููุงุชุฌ ูู ุฏูุชุฑ ุงูููุงุญุธุงุช:

```python
>>> from IPython.display import Audio
>>> Audio(output["audio"], rate=output["sampling_rate"])
```

ููุญุตูู ุนูู ุงููุฒูุฏ ูู ุงูุฃูุซูุฉ ุนูู ูุง ูููู ุฃู ุชูุนูู Bark ูููุงุฐุฌ TTS ุงูุฃุฎุฑู ุงูููุฏุฑุจุฉ ูุณุจููุงุ ุฑุงุฌุน [ุฏูุฑุฉ ุงูุตูุช](https://huggingface.co/learn/audio-course/chapter6/pre-trained_models) ุงูุฎุงุตุฉ ุจูุง.

ุฅุฐุง ููุช ุชุฑุบุจ ูู ุถุจุท ูููุฐุฌ TTSุ ูุฅู ุงูููุงุฐุฌ ุงููุญูุฏุฉ ูุชุญููู ุงููุต ุฅูู ููุงู ุงููุชุงุญุฉ ุญุงูููุง ูู ๐ค Transformers ูู [SpeechT5](model_doc/speecht5) ู [FastSpeech2Conformer](model_doc/fastspeech2_conformer)ุ ุนูู ุงูุฑุบู ูู ุฃูู ุณูุชู ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงููุณุชูุจู. ุชู ุชุฏุฑูุจ SpeechT5 ูุณุจููุง ุนูู ูุฌููุนุฉ ูู ุจูุงูุงุช ุชุญููู ุงูููุงู ุฅูู ูุต ูุชุญููู ุงููุต ุฅูู ููุงูุ ููุง ูุณูุญ ููุง ุจุชุนูู ูุณุงุญุฉ ููุญุฏุฉ ูู ุงูุชูุซููุงุช ุงููุฎููุฉ ุงูุชู ูุดุงุฑููุง ูู ูู ุงููุต ูุงูููุงู. ููุฐุง ูุนูู ุฃูู ูููู ุถุจุท ููุณ ุงููููุฐุฌ ุงูููุฏุฑุจ ูุณุจููุง ูููุงู ูุฎุชููุฉ. ุนูุงูุฉ ุนูู ุฐููุ ูุฏุนู SpeechT5 ูุชุญุฏุซูู ูุชุนุฏุฏูู ูู ุฎูุงู ุชุถููู ุงููุชุญุฏุซ x.

ููุถุญ ุจุงูู ูุฐุง ุงูุฏููู ููููุฉ:

1. ุถุจุท ูููุฐุฌ [SpeechT5](../model_doc/speecht5) ุงูุฐู ุชู ุชุฏุฑูุจู ูู ุงูุฃุตู ุนูู ุงูููุงู ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ ุนูู ุงููุบุฉ ุงูููููุฏูุฉ (`nl`)ุ ููู ูุฌููุนุฉ ูุฑุนูุฉ ูู ูุฌููุนุฉ ุจูุงูุงุช [VoxPopuli](https://huggingface.co/datasets/facebook/voxpopuli).
2. ุงุณุชุฎุฏุงู ูููุฐุฌู ุงููุญุณู ููุงุณุชูุชุงุฌ ุจุทุฑููุชูู: ุจุงุณุชุฎุฏุงู ุฎุท ุฃูุงุจูุจ ุฃู ูุจุงุดุฑุฉ.

ูุจู ุงูุจุฏุกุ ุชุฃูุฏ ูู ุชุซุจูุช ุฌููุน ุงูููุชุจุงุช ุงูุถุฑูุฑูุฉ:

```bash
pip install datasets soundfile speechbrain accelerate
```

ูู ุจุชุซุจูุช ๐คTransformers ูู ุงููุตุฏุฑ ุญูุซ ูู ูุชู ุฏูุฌ ุฌููุน ููุฒุงุช SpeechT5 ูู ุฅุตุฏุงุฑ ุฑุณูู ุจุนุฏ:

```bash
pip install git+https://github.com/huggingface/transformers.git
```

<Tip>

ููุญุตูู ุนูู ูุฐุง ุงูุฏูููุ ุณุชุญุชุงุฌ ุฅูู GPU. ุฅุฐุง ููุช ุชุนูู ูู ุฏูุชุฑ ููุงุญุธุงุชุ ููู ุจุชุดุบูู ุงูุณุทุฑ ุงูุชุงูู ููุชุญูู ููุง ุฅุฐุง ูุงูุช GPU ูุชููุฑุฉ:

```bash
!nvidia-smi
```

ุฃู ุจุฏูู ูู GPUs AMD:

```bash
!rocm-smi
```

</Tip>

ูุญู ูุดุฌุนู ุนูู ุชุณุฌูู ุงูุฏุฎูู ุฅูู ุญุณุงุจ Hugging Face ุงูุฎุงุต ุจู ูุชุญููู ููุดุงุฑูุฉ ูููุฐุฌู ูุน ุงููุฌุชูุน. ุนูุฏูุง ูุชู ูุทุงูุจุชูุ ุฃุฏุฎู ุฑูุฒู ููุชุณุฌูู:

```py
>>> from huggingface_hub import notebook_login

>>> notebook_login()
```

## ุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช
```py
>>> from huggingface_hub import notebook_login

>>> notebook_login()
```

## ุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช

[VoxPopuli](https://huggingface.co/datasets/facebook/voxpopuli) ูู ูุฌููุนุฉ ุจูุงูุงุช ุตูุชูุฉ ูุชุนุฏุฏุฉ ุงููุบุงุช ูุงุณุนุฉ ุงููุทุงู ุชุชููู ูู
ุจูุงูุงุช ูุณุชุฎุฑุฌุฉ ูู ุชุณุฌููุงุช ุฃุญุฏุงุซ ุงูุจุฑููุงู ุงูุฃูุฑูุจู ูู 2009 ุฅูู 2020. ูุญุชูู ุนูู ุจูุงูุงุช ุตูุชูุฉ ูููุญุฉ ูุฎูุณ ุนุดุฑุฉ
ูุบุฉ ุฃูุฑูุจูุฉ. ูู ูุฐุง ุงูุฏูููุ ูุณุชุฎุฏู ุงููุฌููุนุฉ ุงููุฑุนูุฉ ููุบุฉ ุงูููููุฏูุฉุ ูุง ุชุชุฑุฏุฏ ูู ุงุฎุชูุงุฑ ูุฌููุนุฉ ูุฑุนูุฉ ุฃุฎุฑู.

ูุงุญุธ ุฃู VoxPopuli ุฃู ุฃู ูุฌููุนุฉ ุจูุงูุงุช ุฃุฎุฑู ููุชุนุฑู ุงูุชููุงุฆู ุนูู ุงูููุงู (ASR) ูุฏ ูุง ุชููู ุงูุฎูุงุฑ ุงูุฃูุณุจ
ูุชุฏุฑูุจ ููุงุฐุฌ TTS. ุงูููุฒุงุช ุงูุชู ุชุฌุนููุง ูููุฏุฉ ูู ASRุ ูุซู ุงูุถูุถุงุก ุงูุฎูููุฉ ุงูููุฑุทุฉุ ุบูุฑ ูุฑุบูุจ ูููุง ุนุงุฏุฉ ูู TTS. ููุน ุฐููุ ูููู ุฃู ูููู ุงูุนุซูุฑ ุนูู ูุฌููุนุงุช ุจูุงูุงุช TTS ุนุงููุฉ ุงูุฌูุฏุฉ ููุชุนุฏุฏุฉ ุงููุบุงุช ูุงููุชุนุฏุฏุฉ ุงููุชุญุฏุซูู ุฃูุฑูุง ุตุนุจูุง ููุบุงูุฉ.

ุฏุนูุง ูุญูู ุงูุจูุงูุงุช:

```py
>>> from datasets import load_dataset, Audio

>>> dataset = load_dataset("facebook/voxpopuli", "nl", split="train")
>>> len(dataset)
20968
```

20968 ูุซุงู ูุฌุจ ุฃู ูููู ูุงูููุง ููุถุจุท ุงูุฏููู. ูุชููุน SpeechT5 ุฃู ูููู ููุฌููุนุฉ ุงูุจูุงูุงุช ูุนุฏู ุฃุฎุฐ ุนููุงุช ูุจูุบ 16 ูููู ูุฑุชุฒุ ูุฐุง
ุชุฃูุฏ ูู ุฃู ุงูุฃูุซูุฉ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุชูุจู ูุฐุง ุงูุดุฑุท:

```py
dataset = dataset.cast_column("audio", Audio(sampling_rate=16000))
```

## ูุนุงูุฌุฉ ุงูุจูุงูุงุช ูุณุจููุง

ุฏุนูุง ูุจุฏุฃ ุจุชุญุฏูุฏ ููุทุฉ ุชูุชูุด ุงููููุฐุฌ ูุชุญููููุง ูุชุญููู ุงููุนุงูุฌ ุงูููุงุณุจ:

```py
>>> from transformers import SpeechT5Processor

>>> checkpoint = "microsoft/speecht5_tts"
>>> processor = SpeechT5Processor.from_pretrained(checkpoint)
```

### ุชูุธูู ุงููุต ูุชูููููุฒ SpeechT5

ุงุจุฏุฃ ุจุชูุธูู ุจูุงูุงุช ุงููุต. ุณุชุญุชุงุฌ ุฅูู ุงูุฌุฒุก ุงููุนุงูุฌ ูู ุงููุนุงูุฌ ููุนุงูุฌุฉ ุงููุต:

```py
>>> tokenizer = processor.tokenizer
```

ุชุญุชูู ุฃูุซูุฉ ูุฌููุนุฉ ุงูุจูุงูุงุช ุนูู ููุฒุงุช `raw_text` ู `normalized_text`. ุนูุฏ ุงุชุฎุงุฐ ูุฑุงุฑ ุจุดุฃู ุงูููุฒุฉ ุงูุชู ุณูุชู ุงุณุชุฎุฏุงููุง ูุฅุฏุฎุงู ูุตูุ
ุถุน ูู ุงุนุชุจุงุฑู ุฃู ูุนุงูุฌ SpeechT5 ูุง ูุญุชูู ุนูู ุฃู ุฑููุฒ ููุฃุฑูุงู. ูู `normalized_text` ูุชู ูุชุงุจุฉ ุงูุฃุฑูุงู
ูููุต. ูุจุงูุชุงููุ ููู ููุงุณุจ ุจุดูู ุฃูุถูุ ูููุตู ุจุงุณุชุฎุฏุงู `normalized_text` ููุต ุฅุฏุฎุงู.

ูุธุฑูุง ูุฃู SpeechT5 ุชู ุชุฏุฑูุจู ุนูู ุงููุบุฉ ุงูุฅูุฌููุฒูุฉุ ููุฏ ูุง ูุชุนุฑู ุนูู ุฃุญุฑู ูุนููุฉ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูููููุฏูุฉ. ุฅุฐุง
ุชู ุชุฑููุง ููุง ููุ ูุณูุชู ุชุญููู ูุฐู ุงูุฃุญุฑู ุฅูู ุฑููุฒ `<unk>`. ููุน ุฐููุ ูู ุงููุบุฉ ุงูููููุฏูุฉุ ูุชู ุงุณุชุฎุฏุงู ุฃุญุฑู ูุนููุฉ ูุซู `ร`
ููุชุฃููุฏ ุนูู ุงูููุงุทุน. ููุญูุงุธ ุนูู ูุนูู ุงููุตุ ูููููุง ุงุณุชุจุฏุงู ูุฐุง ุงูุญุฑู ุจู `a` ุนุงุฏู.

ูุชุญุฏูุฏ ุงูุฑููุฒ ุบูุฑ ุงููุฏุนููุฉุ ุงุณุชุฎุฑุฌ ุฌููุน ุงูุฃุญุฑู ุงููุฑูุฏุฉ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู `SpeechT5Tokenizer`
ุงูุชู ุชุนูู ูุน ุงูุฃุญุฑู ูุฑููุฒ. ููููุงู ุจุฐููุ ุงูุชุจ ูุธููุฉ `extract_all_chars` mapping ุงูุชู ุชููู ุจุฏูุฌ
ูุตูุต ูู ุฌููุน ุงูุฃูุซูุฉ ูู ุณูุณูุฉ ูุงุญุฏุฉ ูุชุญููููุง ุฅูู ูุฌููุนุฉ ูู ุงูุฃุญุฑู.
ุชุฃูุฏ ูู ุชุนููู `batched=True` ู `batch_size=-1` ูู `dataset.map()` ุจุญูุซ ุชููู ุฌููุน ุงููุตูุต ูุชุงุญุฉ ูุฑุฉ ูุงุญุฏุฉ ููุธููุฉ ุงูุฎุฑูุทุฉ.

```py
>>> def extract_all_chars(batch):
...     all_text = " ".join(batch["normalized_text"])
...     vocab = list(set(all_text))
...     return {"vocab": [vocab], "all_text": [all_text]}


>>> vocabs = dataset.map(
...     extract_all_chars,
...     batched=True,
...     batch_size=-1,
...     keep_in_memory=True,
...     remove_columns=dataset.column_names,
... )

>>> dataset_vocab = set(vocabs["vocab"][0])
>>> tokenizer_vocab = {k for k, _ in tokenizer.get_vocab().items()}
```

ุงูุขู ูุฏูู ูุฌููุนุชุงู ูู ุงูุฃุญุฑู: ูุงุญุฏุฉ ูุน ุงูููุฑุฏุงุช ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ูุงูุฃุฎุฑู ูุน ุงูููุฑุฏุงุช ูู ุงููุนุงูุฌ.
ูุชุญุฏูุฏ ุฃู ุฃุญุฑู ุบูุฑ ูุฏุนููุฉ ูู ูุฌููุนุฉ ุงูุจูุงูุงุชุ ููููู ุฃุฎุฐ ุงููุฑู ุจูู ูุงุชูู ุงููุฌููุนุชูู. ุณุชุชุถูู ุงููุชูุฌุฉ
ุชุนููู ุงูุฃุญุฑู ุงูููุฌูุฏุฉ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ูููู ููุณ ูู ุงููุนุงูุฌ.

```py
>>> dataset_vocab - tokenizer_vocab
{' ', 'ร', 'รง', 'รจ', 'รซ', 'รญ', 'รฏ', 'รถ', 'รผ'}
``````py
>>> dataset_vocab - tokenizer_vocab
{' ', 'ร', 'รง', 'รจ', 'รซ', 'รญ', 'รฏ', 'รถ', 'รผ'}
```

ููุนุงูุฌุฉ ุงูุฃุญุฑู ุบูุฑ ุงููุฏุนููุฉ ุงูุชู ุชู ุชุญุฏูุฏูุง ูู ุงูุฎุทูุฉ ุงูุณุงุจูุฉุ ุญุฏุฏ ูุธููุฉ ุชููู ุจุชุนููู ูุฐู ุงูุฃุญุฑู ุฅูู
ุฑููุฒ ุตุงูุญุฉ. ูุงุญุธ ุฃู ุงููุณุงูุงุช ูุชู ุงุณุชุจุฏุงููุง ุจุงููุนู ุจู `โ` ูู ุงููุนุงูุฌ ููุง ุชุญุชุงุฌ ุฅูู ูุนุงูุฌุฉ ูููุตูุฉ.

```py
>>> replacements = [
...     ("ร", "a"),
...     ("รง", "c"),
...     ("รจ", "e"),
...     ("รซ", "e"),
...     ("รญ", "i"),
...     ("รฏ", "i"),
...     ("รถ", "o"),
...     ("รผ", "u"),
... ]


>>> def cleanup_text(inputs):
...     for src, dst in replacements:
...         inputs["normalized_text"] = inputs["normalized_text"].replace(src, dst)
...     return inputs


>>> dataset = dataset.map(cleanup_text)
```

ุงูุขู ุจุนุฏ ุฃู ุชุนุงููุช ูุน ุงูุฃุญุฑู ุงูุฎุงุตุฉ ูู ุงููุตุ ุญุงู ุงูููุช ููุชุฑููุฒ ุนูู ุจูุงูุงุช ุงูุตูุช.

### ุงููุชุญุฏุซูู

ุชุชุถูู ูุฌููุนุฉ ุจูุงูุงุช VoxPopuli ููุงููุง ูู ูุชุญุฏุซูู ูุชุนุฏุฏููุ ูููู ูู ุนุฏุฏ ุงููุชุญุฏุซูู ุงูููุซููู ูู ูุฌููุนุฉ ุงูุจูุงูุงุชุ ูุชุญุฏูุฏ ุฐููุ ูููููุง
ุนุฏ ุนุฏุฏ ุงููุชุญุฏุซูู ุงููุฑูุฏูู ูุนุฏุฏ ุงูุฃูุซูุฉ ุงูุชู ูุณุงูู ุจูุง ูู ูุชุญุฏุซ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช.
ูุน ูุง ูุฌููุนู 20968 ูุซุงู ูู ูุฌููุนุฉ ุงูุจูุงูุงุชุ ุณุชููุญูุง ูุฐู ุงููุนูููุงุช ููููุง ุฃูุถู ูุชูุฒูุน ุงููุชุญุฏุซูู ูุงูุฃูุซูุฉ ูู ุงูุจูุงูุงุช.

```py
>>> from collections import defaultdict

>>> speaker_counts = defaultdict(int)

>>> for speaker_id in dataset["speaker_id"]:
...     speaker_counts[speaker_id] += 1
```

ูู ุฎูุงู ุฑุณู ูุฎุทุท ุชูุฒูุน ุงูุชูุฑุงุฑูุ ููููู ุงูุญุตูู ุนูู ููุฑุฉ ุนู ููุฏุงุฑ ุงูุจูุงูุงุช ุงููุชููุฑุฉ ููู ูุชุญุฏุซ.

```py
>>> import matplotlib.pyplot as plt

>>> plt.figure()
>>> plt0.hist(speaker_counts.values(), bins=20)
>>> plt.ylabel("Speakers")
>>> plt.xlabel("Examples")
>>> plt.show()
```

<div class="flex justify-center">
    <img src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/transformers/tasks/tts_speakers_histogram.png" alt="Speakers histogram"/>
</div>

ููุดู ูุฎุทุท ุงูุชูุฒูุน ุงูุชูุฑุงุฑู ุฃู ุญูุงูู ุซูุซ ุงููุชุญุฏุซูู ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ูุฏููู ุฃูู ูู 100 ูุซุงูุ ูู ุญูู ุฃู ุญูุงูู ุนุดุฑุฉ ูุชุญุฏุซูู ูุฏููู ุฃูุซุฑ ูู 500 ูุซุงู. ูุชุญุณูู ููุงุกุฉ ุงูุชุฏุฑูุจ ูุชูุงุฒู ูุฌููุนุฉ ุงูุจูุงูุงุชุ ูููููุง ุชุญุฏูุฏ
ุงูุจูุงูุงุช ุฅูู ูุชุญุฏุซูู ูุชุฑุงูุญ ุนุฏุฏูู ุจูู 100 ู400 ูุซุงู.

```py
>>> def select_speaker(speaker_id):
...     return 100 <= speaker_counts[speaker_id] <= 400


>>> dataset = dataset.filter(select_speaker, input_columns=["speaker_id"])
```

ุฏุนูุง ูุชุญูู ูู ุนุฏุฏ ุงููุชุญุฏุซูู ุงููุชุจููู:

```py
>>> len(set(dataset["speaker_id"]))
42
```

ุฏุนูุง ูุฑู ุนุฏุฏ ุงูุฃูุซูุฉ ุงููุชุจููุฉ:

```py
>>> len(dataset)
9973
```

ุฃูุช ุงูุขู ูุฏูู ุฃูู ุจูููู ูู 10000 ูุซุงู ูู ุญูุงูู 40 ูุชุญุฏุซูุง ูุฑูุฏูุงุ ููู ูุง ูุฌุจ ุฃู ูููู ูุงูููุง.

ูุงุญุธ ุฃู ุจุนุถ ุงููุชุญุฏุซูู ุฐูู ุงูุฃูุซูุฉ ุงูููููุฉ ูุฏ ูููู ูุฏููู ูู ุงููุงูุน ุงููุฒูุฏ ูู ุงูุตูุช ุงููุชุงุญ ุฅุฐุง ูุงูุช ุงูุฃูุซูุฉ ุทูููุฉ. ููุน ุฐููุ
ุชุญุฏูุฏ ุฅุฌูุงูู ููุฏุงุฑ ุงูุตูุช ููู ูุชุญุฏุซ ูุชุทูุจ ูุญุต ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุฃููููุงุ ููู ุนูููุฉ ุชุณุชุบุฑู ููุชูุง ุทูููุงู ุชูุทูู ุนูู ุชุญููู ููู ุชุดููุฑ ูู ููู ุตูุชู. ูุฐููุ ููุฏ ุงุฎุชุฑูุง ุชุฎุทู ูุฐู ุงูุฎุทูุฉ ููุง.

### ุชุถููู ุงููุชุญุฏุซ

ูุชูููู ูููุฐุฌ TTS ูู ุงูุชูููุฒ ุจูู ูุชุญุฏุซูู ูุชุนุฏุฏููุ ุณุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ุชุถููู ูุชุญุฏุซ ููู ูุซุงู.
ุชุถููู ุงููุชุญุฏุซ ูู ุฅุฏุฎุงู ุฅุถุงูู ูู ุงููููุฐุฌ ุงูุฐู ููุชูุท ุฎุตุงุฆุต ุตูุช ุงููุชุญุฏุซ.
ูุฅูุดุงุก ูุฐู ุงูุชุถูููุงุช ุงููุชุญุฏุซุ ุงุณุชุฎุฏู ุงููููุฐุฌ ุงูููุฏุฑุจ ูุณุจููุง [spkrec-xvect-voxceleb](https://huggingface.co/speechbrain/spkrec-xvect-voxceleb)
ูู SpeechBrain.

ูู ุจุฅูุดุงุก ูุธููุฉ `create_speaker_embedding()` ุงูุชู ุชุฃุฎุฐ ููุฌุฉ ุตูุช ุฅุฏุฎุงู ูุชุฎุฑุฌ ูุชุฌู 512 ุนูุตุฑูุง
ูุญุชูู ุนูู ุชุถููู ุงููุชุญุฏุซ ุงูููุงุจู.

```py
>>> import os
>>> import torch
>>> from speechbrain.inference.classifiers import EncoderClassifier

>>> spk_model_name = "speechbrain/spkrec-xvect-voxceleb"
```py
>>> import os
>>> import torch
>>> from speechbrain.inference.classifiers import EncoderClassifier

>>> spk_model_name = "speechbrain/spkrec-xvect-voxceleb"

>>> device = "cuda" if torch.cuda.is_available() else "cpu"
>>> speaker_model = EncoderClassifier.from_hparams(
...     source=spk_model_name,
...     run_opts={"device": device},
...     savedir=os.path.join("/tmp", spk_model_name),
... )


>>> def create_speaker_embedding(waveform):
...     with torch.no_grad():
...         speaker_embeddings = speaker_model.encode_batch(torch.tensor(waveform))
...         speaker_embeddings = torch.nn.functional.normalize(speaker_embeddings, dim=2)
...         speaker_embeddings = speaker_embeddings.squeeze().cpu().numpy()
...     return speaker_embeddings
```

ูู ุงูููู ููุงุญุธุฉ ุฃู ุงููููุฐุฌ `speechbrain/spkrec-xvect-voxceleb` ุชู ุชุฏุฑูุจู ุนูู ุงูููุงู ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ ูู ูุฌููุนุฉ ุจูุงูุงุช VoxCeleb
ูู ุญูู ุฃู ุฃูุซูุฉ ุงูุชุฏุฑูุจ ูู ูุฐุง ุงูุฏููู ุจุงููุบุฉ ุงูููููุฏูุฉ. ูู ุญูู ุฃููุง ูุนุชูุฏ ุฃู ูุฐุง ุงููููุฐุฌ ุณูุธู ูููุฏ
ุชุถูููุงุช ุงููุชุญุฏุซูู ุงููุนููููู ููุฌููุนุฉ ุงูุจูุงูุงุช ุงูููููุฏูุฉ ุงูุฎุงุตุฉ ุจูุงุ ููุฏ ูุง ูููู ูุฐุง ุงูุงูุชุฑุงุถ ุตุญูุญูุง ูู ุฌููุน ุงูุญุงูุงุช.

ููุญุตูู ุนูู ูุชุงุฆุฌ ูุซุงููุฉุ ููุตู ุจุชุฏุฑูุจ ูููุฐุฌ X-vector ุนูู ุงูููุงู ุงููุณุชูุฏู ุฃููุงู. ุณูููู ุฐูู ูุฏุฑุฉ ุงููููุฐุฌ ุนูู
ุงูุงูุชูุงุท ุจุดูู ุฃูุถู ูุฎุตุงุฆุต ุงูุตูุช ุงููุฑูุฏุฉ ุงูููุฌูุฏุฉ ูู ุงููุบุฉ ุงูููููุฏูุฉ.

### ูุนุงูุฌุฉ ูุฌููุนุฉ ุงูุจูุงูุงุช

ุฃุฎูุฑูุงุ ุฏุนูุง ูููู ุจูุนุงูุฌุฉ ุงูุจูุงูุงุช ุฅูู ุงูุชูุณูู ุงูุฐู ูุชููุนู ุงููููุฐุฌ. ูู ุจุฅูุดุงุก ูุธููุฉ `prepare_dataset` ุงูุชู ุชุฃุฎุฐ ูุซุงููุง ูุงุญุฏูุง ูุชุณุชุฎุฏู ูุงุฆู `SpeechT5Processor` ูุชูููููุฒ ุฅุฏุฎุงู ุงููุต ูุชุญููู ุงูุตูุช ุงููุณุชูุฏู ูู ูุฎุทุท Mel-spectrogram.
ูุฌุจ ุฃู ุชุถูู ุฃูุถูุง ุชุถูููุงุช ุงููุชุญุฏุซูู ูุฅุฏุฎุงู ุฅุถุงูู.

```py
>>> def prepare_dataset(example):
...     audio = example["audio"]

...     example = processor(
...         text=example["normalized_text"],
...         audio_target=audio["array"],
...         sampling_rate=audio["sampling_rate"],
...         return_attention_mask=False,
...     )

...     # strip off the batch dimension
...     example["labels"] = example["labels"][0]

...     # use SpeechBrain to obtain x-vector
...     example["speaker_embeddings"] = create_speaker_embedding(audio["array"])

...     return example
```

ุชุญูู ูู ุตุญุฉ ุงููุนุงูุฌุฉ ุนู ุทุฑูู ุงููุธุฑ ูู ูุซุงู ูุงุญุฏ:

```py
>>> processed_example = prepare_dataset(dataset[0])
>>> list(processed_example.keys())
['input_ids', 'labels', 'stop_labels', 'speaker_embeddings']
```

ูุฌุจ ุฃู ุชููู ุชุถูููุงุช ุงููุชุญุฏุซูู ุนุจุงุฑุฉ ุนู ูุชุฌู ูููู ูู 512 ุนูุตุฑูุง:

```py
>>> processed_example["speaker_embeddings"].shape
(512,)
```

ูุฌุจ ุฃู ุชููู ุงูุชุณู
ูู ูุชู ุชุฑุฌูุฉ ุงูุฃุฌุฒุงุก ุงููุญุฏุฏุฉ ูู ุงููุต ุงูุฃุตูู ุจูุงุกู ุนูู ุทูุจู.

```python
>>> from transformers import Seq2SeqTrainingArguments

>>> training_args = Seq2SeqTrainingArguments(
...     output_dir="speecht5_finetuned_voxpopuli_nl",  # ูู ุจุชุบููุฑู ุฅูู ุงุณู ูุณุชูุฏุน ูู ุงุฎุชูุงุฑู
...     per_device_train_batch_size=4,
...     gradient_accumulation_steps=8,
...     learning_rate=1e-5,
...     warmup_steps=500,
...     max_steps=4000,
...     gradient_checkpointing=True,
...     fp16=True,
...     eval_strategy="steps",
...     per_device_eval_batch_size=2,
...     save_steps=1000,
...     eval_steps=1000,
...     logging_steps=25,
...     report_to=["tensorboard"],
...     load_best_model_at_end=True,
...     greater_is_better=False,
...     label_names=["labels"],
...     push_to_hub=True,
... )
```

ูู ุจุชููุฆุฉ ูุงุฆู 'Trainer' ููุฑุฑ ุฅููู ุงููููุฐุฌ ููุฌููุนุฉ ุงูุจูุงูุงุช ููุณููุฉ ุชุฌููุน ุงูุจูุงูุงุช.

```py
>>> from transformers import Seq2SeqTrainer

>>> trainer = Seq2SeqTrainer(
...     args=training_args,
...     model=model,
...     train_dataset=dataset["train"],
...     eval_dataset=dataset["test"],
...     data_collator=data_collator,
...     tokenizer=processor,
... )
```

ูุงูุขูุ ุฃูุช ูุณุชุนุฏ ูุจุฏุก ุงูุชุฏุฑูุจ! ุณูุณุชุบุฑู ุงูุชุฏุฑูุจ ุนุฏุฉ ุณุงุนุงุช. ูุงุนุชูุงุฏูุง ุนูู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณูููุงุช (GPU) ูุฏููุ ููุฏ ุชูุงุฌู ุฎุทุฃ "ููุงุฏ ุงูุฐุงูุฑุฉ" ูู CUDA ุนูุฏ ุจุฏุก ุงูุชุฏุฑูุจ. ูู ูุฐู ุงูุญุงูุฉุ ููููู ุชูููู `per_device_train_batch_size` ุจุดูู ุชุฏุฑูุฌู ุจูุถุงุนูุงุช 2 ูุฒูุงุฏุฉ `gradient_accumulation_steps` ุจููุฏุงุฑ 2x ููุชุนููุถ.

```py
>>> trainer.train()
```

ูุงุณุชุฎุฏุงู ููุทุฉ ุงูุชูุชูุด ุงูุฎุงุตุฉ ุจู ูุน ุฎุท ุฃูุงุจูุจุ ุชุฃูุฏ ูู ุญูุธ ุงููุนุงูุฌ ูุน ููุทุฉ ุงูุชูุชูุด:

```py
>>> processor.save_pretrained("YOUR_ACCOUNT_NAME/speecht5_finetuned_voxpopuli_nl")
```

ุฃุฑุณู ุงููููุฐุฌ ุงูููุงุฆู ุฅูู ๐ค Hub:

```py
>>> trainer.push_to_hub()
```

## ุงูุงุณุชูุชุงุฌ

### ุงูุงุณุชูุชุงุฌ ุจุงุณุชุฎุฏุงู ุฎุท ุฃูุงุจูุจ

ุงูุขู ุจุนุฏ ุฃู ููุช ุจุถุจุท ูููุฐุฌุ ููููู ุงุณุชุฎุฏุงูู ููุงุณุชูุชุงุฌ!
ุฃููุงูุ ุฏุนูุง ูุฑู ููู ููููู ุงุณุชุฎุฏุงูู ูุน ุฎุท ุฃูุงุจูุจ ูุทุงุจู. ุฏุนูุง ููุดุฆ ุฎุท ุฃูุงุจูุจ `"text-to-speech"` ูุน ููุทุฉ ุงูุชูุชูุด ุงูุฎุงุตุฉ ุจู:

```py
>>> from transformers import pipeline

>>> pipe = pipeline("text-to-speech", model="YOUR_ACCOUNT_NAME/speecht5_finetuned_voxpopuli_nl")
```

ุงุฎุชุฑ ูุทุนุฉ ูู ุงููุต ุจุงููุบุฉ ุงูููููุฏูุฉ ุงูุชู ุชุฑูุฏ ุณุฑุฏูุงุ ุนูู ุณุจูู ุงููุซุงู:

```py
>>> text = "hallo allemaal, ik praat nederlands. groetjes aan iedereen!"
```

ูุงุณุชุฎุฏุงู SpeechT5 ูุน ุฎุท ุงูุฃูุงุจูุจุ ุณุชุญุชุงุฌ ุฅูู embedding ูููุชููู. ุฏุนูุง ูุญุตู ุนููู ูู ูุซุงู ูู ูุฌููุนุฉ ุงูุงุฎุชุจุงุฑ:

```py
>>> example = dataset["test"][304]
>>> speaker_embeddings = torch.tensor(example["speaker_embeddings"]).unsqueeze(0)
```

ุงูุขู ููููู ุชูุฑูุฑ ุงููุต ู embeddings ูููุชููู ุฅูู ุฎุท ุงูุฃูุงุจูุจุ ูุณูุชููู ุจููุฉ ุงููููุฉ:

```py
>>> forward_params = {"speaker_embeddings": speaker_embeddings}
>>> output = pipe(text, forward_params=forward_params)
>>> output
{'audio': array([-6.82714235e-05, -4.26525949e-04,  1.06134125e-04, ...,
        -1.22392643e-03, -7.76011671e-04,  3.29112721e-04], dtype=float32),
 'sampling_rate': 16000}
```

ููููู ุจุนุฏ ุฐูู ุงูุงุณุชูุงุน ุฅูู ุงููุชูุฌุฉ:

```py
>>> from IPython.display import Audio
>>> Audio(output['audio'], rate=output['sampling_rate'])
```

### ุชุดุบูู ุงูุงุณุชุฏูุงู ูุฏูููุง

ููููู ุชุญููู ููุณ ูุชุงุฆุฌ ุงูุงุณุชุฏูุงู ุฏูู ุงุณุชุฎุฏุงู ุฎุท ุงูุฃูุงุจูุจุ ูููู ุณุชููู ููุงู ุญุงุฌุฉ ุฅูู ูุฒูุฏ ูู ุงูุฎุทูุงุช.

ูู ุจุชุญููู ุงููููุฐุฌ ูู ๐ค Hub:

```py
>>> model = SpeechT5ForTextToSpeech.from_pretrained("YOUR_ACCOUNT/speecht5_finetuned_voxpopuli_nl")
```

ุงุฎุชุฑ ูุซุงูุงู ูู ูุฌููุนุฉ ุงูุงุฎุชุจุงุฑ ููุญุตูู ุนูู embedding ูููุชููู.

```py
>>> example = dataset["test"][304]
>>> speaker_embeddings = torch.tensor(example["speaker_embeddings"]).unsqueeze(0)
```

ูู ุจุชุนุฑูู ูุต ุงูุฅุฏุฎุงู ููู ุจุฑูุชู:

```py
>>> text = "hallo allemaal, ik praat nederlands. groetjes aan iedereen!"
>>> inputs = processor(text=text, return_tensors="pt")
```

ูู ุจุฅูุดุงุก ูุฎุทุท ุทููู ูุน ูููุฐุฌู:

```py
>>> spectrogram = model.generate_speech(inputs["input_ids"], speaker_embeddings)
```

ูู ุจุชุตูุฑ ุงููุฎุทุท ุงูุทูููุ ุฅุฐุง ุฃุฑุฏุช:

```py
>>> plt.figure()
>>> plt.imshow(spectrogram.T)
>>> plt.show()
```

<div class="flex justify-center">
    <img src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/transformers/tasks/tts_logmelspectrogram_2.png" alt="ูุฎุทุท ุทููู ููุบุงุฑูุชูู ูููุฏ"/>
</div>

ุฃุฎูุฑูุงุ ุงุณุชุฎุฏู ุงููุญูู ุงูุชูุงุธุฑู ุงูุฑููู ูุชุญููู ุงููุฎุทุท ุงูุทููู ุฅูู ุตูุช.

```py
>>> with torch.no_grad():
...     speech = vocoder(spectrogram)

>>> from IPython.display import Audio

>>> Audio(speech.numpy(), rate=16000)
```

ูู ุชุฌุฑุจุชูุงุ ูุฏ ูููู ูู ุงูุตุนุจ ุงูุญุตูู ุนูู ูุชุงุฆุฌ ูุฑุถูุฉ ูู ูุฐุง ุงููููุฐุฌ. ุชุจุฏู ุฌูุฏุฉ embeddings ูููุชููู ุนุงููุงู ููููุง. ูุธุฑูุง ูุฃู SpeechT5 ุชู ุชุฏุฑูุจู ูุณุจููุง ุจุงุณุชุฎุฏุงู x-vectors ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉุ ูุฅูู ูุนูู ุจุดูู ุฃูุถู ุนูุฏ ุงุณุชุฎุฏุงู embeddings ูููุชููู ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ. ุฅุฐุง ูุงู ุงูููุงู ุงูููุฎูููู ูุจุฏู ุฑุฏูุฆูุงุ ูุฌุฑูุจ ุงุณุชุฎุฏุงู embedding ูุฎุชูู ูููุชููู.

ููู ุงููุฑุฌุญ ุฃูุถูุง ุฃู ูุคุฏู ุฒูุงุฏุฉ ูุฏุฉ ุงูุชุฏุฑูุจ ุฅูู ุชุญุณูู ุฌูุฏุฉ ุงููุชุงุฆุฌ. ููุน ุฐููุ ูู ุงููุงุถุญ ุฃู ุงูููุงู ุจุงููุบุฉ ุงูููููุฏูุฉ ุจุฏูุงู ูู ุงููุบุฉ ุงูุฅูุฌููุฒูุฉุ ููุชู ุจุงููุนู ุงูุชูุงุท ุฎุตุงุฆุต ุตูุช ุงููุชุญุฏุซ (ููุงุฑูุฉ ุจุงูุตูุช ุงูุฃุตูู ูู ุงููุซุงู).

ุดูุก ุขุฎุฑ ูููู ุชุฌุฑุจุชู ูู ุชูููู ุงููููุฐุฌ. ุนูู ุณุจูู ุงููุซุงูุ ุฌุฑุจ ุงุณุชุฎุฏุงู `config.reduction_factor = 1` ููุนุฑูุฉ ูุง ุฅุฐุง ูุงู ูุฐุง ูุญุณู ุงููุชุงุฆุฌ.

ุฃุฎูุฑูุงุ ูู ุงูููู ูุฑุงุนุงุฉ ุงูุงุนุชุจุงุฑุงุช ุงูุฃุฎูุงููุฉ. ุนูู ุงูุฑุบู ูู ุฃู ุชูููุฉ TTS ูุฏููุง ุงูุนุฏูุฏ ูู ุงูุชุทุจููุงุช ุงููููุฏุฉุ ุฅูุง ุฃููุง ูุฏ ุชูุณุชุฎุฏู ุฃูุถูุง ูุฃุบุฑุงุถ ุฎุจูุซุฉุ ูุซู ุงูุชุญุงู ุตูุช ุดุฎุต ูุง ุฏูู ูุนุฑูุชู ุฃู ููุงููุชู. ูุฑุฌู ุงุณุชุฎุฏุงู TTS ุจุญููุฉ ูุจูุณุคูููุฉ.